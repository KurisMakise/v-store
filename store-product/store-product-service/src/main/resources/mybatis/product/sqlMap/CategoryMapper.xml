<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="store.product.mapper.CategoryMapper">
  <resultMap id="BaseResultMap" type="store.product.entity.Category">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Feb 27 20:00:00 CST 2019.
    -->
    <constructor>
      <idArg column="category_id" javaType="java.lang.Long" jdbcType="BIGINT" />
      <arg column="parent_id" javaType="java.lang.Long" jdbcType="BIGINT" />
      <arg column="name" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="sort" javaType="java.lang.Integer" jdbcType="INTEGER" />
      <arg column="type" javaType="java.lang.Byte" jdbcType="TINYINT" />
      <arg column="status" javaType="java.lang.Byte" jdbcType="TINYINT" />
      <arg column="show_in_nav" javaType="java.lang.Byte" jdbcType="TINYINT" />
      <arg column="show_in_top" javaType="java.lang.Byte" jdbcType="TINYINT" />
      <arg column="show_in_hot" javaType="java.lang.Byte" jdbcType="TINYINT" />
      <arg column="create_time" javaType="java.util.Date" jdbcType="TIMESTAMP" />
      <arg column="create_by" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="update_time" javaType="java.util.Date" jdbcType="TIMESTAMP" />
      <arg column="update_by" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="page_title" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="page_description" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="page_keyword" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="remarks" javaType="java.lang.String" jdbcType="VARCHAR" />
    </constructor>
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Feb 27 20:00:00 CST 2019.
    -->
    category_id, parent_id, name, sort, type, status, show_in_nav, show_in_top, show_in_hot, 
    create_time, create_by, update_time, update_by, page_title, page_description, page_keyword, 
    remarks
  </sql>

    <select id="getCategory" resultType="store.product.entity.Category">
        SELECT category_id as categoryId,
               parent_id   as parentId,
               name
        FROM os_category
        WHERE category_id =
              (SELECT category_id
               FROM os_product_category
               WHERE product_id =#{productId})
        AND status = #{status};
    </select>

  <select id="listTopCategoryAdvert" resultType="store.product.pojo.vo.CategoryVO">
    SELECT
        c.category_id as categoryId,
	    c.name,
	    a.category_advert_id as categoryAdvertId,
        a.title,
	    a.href,
	    a.pic_img as picImg
    FROM
        os_category c
    LEFT JOIN

          (
            SELECT
                  a.*
            FROM
                  os_category_advert a
            WHERE
                a.sort = (
                       SELECT
                            max(sort)
                        FROM
                            os_category_advert
                        WHERE
                            category_id = a.category_id
                )
          ) a

            ON c.category_id = a.category_id
    WHERE
       <!-- a.begin_time &lt;= #{advertDate}
    AND a.end_time &gt;= #{advertDate}
    AND -->a.status = #{status}
    AND c.status = #{status}
    AND c.type = #{type}
    AND c.show_in_top = #{showInTop}
    ORDER BY
        c.sort,
        a.sort
  </select>

  <select id="listSubCategoryIds" resultType="long">
    SELECT
        category_id as categoryId
    FROM
        os_category
    WHERE
        STATUS = #{status}
    AND parent_id in (
        SELECT
           category_id
        FROM
           os_category
        WHERE
           category_id = #{categoryId}
        AND status = #{status}
    )
    OR category_id = #{categoryId}
    OR parent_id = #{categoryId}
  </select>

</mapper>